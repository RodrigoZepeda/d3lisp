
        <!DOCTYPE html>
        <html lang='en'>
            <head>
                    <title>Plot 1</title>

                    <meta charset = 'utf-8'>
                    <meta name='viewport' content='width=device-width, initial-scale=1'>
                    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
                    <meta name='description' content='d3lisp plot'>
                    <meta name='author' content='d3lisp'>

                    <!-- Favicon ico to include logo -->
                    <link rel='shortcut icon' href='favicon.ico' type='image/x-icon'>
                    <link rel='icon' href='favicon.ico' type='image/x-icon'>

                    <!--Nice bootstrap format (could be simplified to improve loading)-->
                    <link href='https://bootswatch.com/3/cerulean/bootstrap.css' rel='stylesheet' media = 'all'>

                    <!-- Inclusion of d3js for plotting-->
                    <script src='https://d3js.org/d3.v5.min.js'></script>

                    <!-- Saving libraries -->
                    <script src='https://cdn.rawgit.com/eligrey/canvas-toBlob.js/master/canvas-toBlob.js'></script>
	                  <script src='https://cdn.rawgit.com/eligrey/FileSaver.js/e9d941381475b5df8b7d7691013401e171014e89/FileSaver.min.js'></script>
                    <script src='https://cdn.rawgit.com/eligrey/Blob.js/master/Blob.js'></script>
            </head>
            <body>
                <div class = 'panel panel-default'>
                        <div class='panel-heading'><button id='generate' class='btn btn-primary btn-sm'>Save</button></div>
                        <div class='panel-body'>
                            <div class = 'row'>
                                <div id = 'myfigure' style = 'text-align:center;'></div>

                                <!-- This is the part that lisp changes --><script>/*---------------------------------VARIABLES FOR LISP LOOP*/
var xdata0=[0.0,0.5,1.0,1.5,2.0,2.5,3.0,3.5,4.0,4.5,5.0],ydata0=[1.0,1.6487212,2.7182817,4.481689,7.389056,12.182494,20.085537,33.11545,54.59815,90.01713,148.41316],scatter0=true,line0=true,radii0=7.0,linewidth0=3.0,lineopacity0=1.0,scatteropacity0=1.0,scattercolor0='green',linecolor0='purple',strokefill0='none',plotcurve0= d3.curveMonotoneX;/*---------------------------------END OF VARIABLES FOR LISP LOOP*/
var xlab       = 'x';var ylab       = 'exp(x)';var title      = 'Exponential';var filename   = 'Myplot.svg';var xmin       = 0.0;var xmax       = 5.0;var ymin       = 1.0;var ymax       = 148.41316;var xaxispos   = 1.0;var yaxispos   = 0.0;var showXaxis  = true;var showYaxis  = true;var save       = false;var squareplot = true;var axisX_color        = 'black';var axisY_color        = 'black';var axisX_label_color  = 'black';var axisY_label_color  = 'black';var axisX_tick_color   = 'black';var axisY_tick_color   = 'black';var outercolor         = 'none';var innercolor         = 'none';var titlefontsize      = 100.0;var titlecolor         = 'black';var outerHeight = 0.9*Math.max(document.documentElement['clientHeight'], document.body['scrollHeight'], document.documentElement['scrollHeight'], document.body['offsetHeight'], document.documentElement['offsetHeight']);var outerWidth  = 0.9*Math.max(document.documentElement['clientWidth'], document.body['scrollWidth'], document.documentElement['scrollWidth'], document.body['offsetWidth'], document.documentElement['offsetWidth']);var margin  = {top:10.0,
                                                    right:10.0,
                                                    bottom:10.0,
                                                    left:10.0};var padding = {top:150.0,
                                                    right:30.0,
                                                    bottom:60.0,
                                                    left:60.0};</script>                           <!-- D3JS script for plotting-->
                                <script>


                                        if (squareplot){
                                            outerHeight  = Math.min(outerHeight, outerWidth);
                                            outerWidth   = Math.min(outerHeight, outerWidth);
                                        }

                                        var innerWidth   = outerWidth  - margin.left  - margin.right,
                                            innerHeight  = outerHeight - margin.top   - margin.bottom,
                                            width        = innerWidth  - padding.left - padding.right,
                                            height       = innerHeight - padding.top  - padding.bottom,
                                            background   = false;

                                        //Creation of canvas
                                        var outer = d3.select('#myfigure').append('svg')
                                                        .attr('width', outerWidth)
                                                        .attr('height', outerHeight);

                                        //Rectangles for debugging
                                        outer.append('rect')
                                               .attr('fill', outercolor)
                                               .attr('width', innerWidth)
                                               .attr('height', innerHeight);

                                        var inner = outer.append('g')
                                                        .attr('transform', 'translate(' + padding.left + ',' + padding.top + ')');

                                        //Rectangles for debugging
                                        inner.append('rect')
                                            .attr('fill', innercolor)
                                            .attr('width', width)
                                            .attr('height', height);

                                        //X.axis
                                        Xscale = d3.scaleLinear()
                                                    .domain([xmin, xmax])
                                                    .range([0, width]);

                                        //Y-axis
                                        Yscale = d3.scaleLinear()
                                                    .domain([ymin, ymax])
                                                    .range([height, 0]);

                                        //Create plot title
                                        inner.append('text')
                                                .attr('x', (width / 2))
                                                .attr('y', 0 - (padding.top / 2))
                                                .attr('text-anchor', 'middle')
                                                .style('font-size', titlefontsize)
                                                .style('font-family', 'sans-serif')
                                                .style('font-weight', 'bold')
                                                .attr('fill', titlecolor)
                                                .text(title);

/*--------------------------------------PART THAT NEEDS TO BE IN LISP LOOP*/
                        // Creating path using data in pathinfo and path data generator
                        if (line0){

                            // Specify the function for generating path data
                            var myline = d3.line()
                                .x(function(d){return Xscale(d);})
                                .y(function(d,k){return Yscale(ydata0[k]);})
                                .curve(plotcurve0);

                            inner.append('path')
                                .attr('d', myline(xdata0))
                                .style('strokewidth', linewidth0)
                                .style('stroke', linecolor0)
                                .style('opacity',lineopacity0)
                                .style('fill', strokefill0);
                        }
                        //Creating the scatter
                        if (scatter0){
                            inner.selectAll('scatter-dots')
                                .data(ydata0)   // using the values in the ydata array
                                .enter().append('svg:circle') // create a new circle for each value
                                .attr('cy', function(d){return Yscale(d);}) // translate y
                                .attr('cx', function(d,k){return Xscale(xdata0[k]);})
                                .attr('r', radii0) // radius of circle
                                .style('opacity', scatteropacity0)
                                .style('fill', scattercolor0);
                        }
                        /*--------------------------------------END OF PART THAT NEEDS TO BE IN LISP LOOP*/

                                        if (showXaxis){
                                            axisX  = inner.append('g')
                                                            .attr('transform', 'translate(' + 0 + ',' + Yscale(xaxispos) + ')')
                                                            .style('stroke', axisX_tick_color)
                                                            .call(d3.axisBottom(Xscale));

                                            axisX.selectAll('line').style('stroke', axisX_tick_color);
                                            axisX.selectAll('path').style('stroke', axisX_color);

                                            //Create X axis label
                                            outer.append('text')
                                                .attr('x', innerWidth / 2 )
                                                .attr('y',  innerHeight - padding.top/2)
                                                .style('text-anchor', 'middle')
                                                .style('font-family', 'sans-serif')
                                                .style('fill', axisX_label_color)
                                                .text(xlab);

                                        }

                                        if (showYaxis){
                                            axisY = inner.append('g')
                                                        .attr('transform', 'translate(' + Xscale(yaxispos) + ',' + 0 + ')')
                                                        .style('stroke', axisX_tick_color)
                                                        .call(d3.axisLeft(Yscale));

                                            axisY.selectAll('line').style('stroke', axisY_tick_color);
                                            axisY.selectAll('path').style('stroke', axisY_color);

                                            //Create Y axis label
                                            outer.append('text')
                                                .attr('y', 0)
                                                .attr('x', 0)
                                                .attr('transform', 'translate(' + 0 + ',' + innerHeight/2 + ') rotate(-90)')
                                                .attr('dy', '1em')
                                                .style('text-anchor', 'middle')
                                                .style('font-family', 'sans-serif')
                                                .style('fill', axisY_label_color)
                                                .text(ylab);
                                        }

                                        d3.selectAll('.tick > text').style('font-weight','lighter');

                                    </script><!-- SCRIPT FOR SAVING; ADAPTED FROM http://bl.ocks.org/wboykinm/e6e222d71e9b59e8b3053e0c4fe83daf -->
                                    <script>
                                        d3.select('#generate')
                                            .on('click', writeDownloadLink);

                                        function writeDownloadLink(){
                                            try {
                                                var isFileSaverSupported = !!new Blob();
                                            } catch (e) {
                                                alert('blob not supported');
                                            }

                                            var html = d3.select('svg')
                                                .attr('title', 'test2')
                                                .attr('version', 1.1)
                                                .attr('xmlns', 'http://www.w3.org/2000/svg')
                                                .node().parentNode.innerHTML;

                                            var blob = new Blob([html], {type: 'image/svg+xml'});
                                            saveAs(blob, filename);
                                        };
                                        if (save){
                                            window.onload = function(){document.getElementById('generate').click();};
                                        }

                                    </script>
                            </div>
                        </div>
                    </div>
                </body>
            </body>
        </html>